name: XSS攻击检测 (增强版)
pattern:
  # 直接脚本注入检测 (包括各种编码和变体)
  params: '(<\s*script[^>]*>.*?<\s*/\s*script\s*>|<\s*iframe[^>]*>.*?<\s*/\s*iframe\s*>)'

  # JavaScript协议和事件处理器 (包括绕过技术)
  params: '(javascript\s*:|data\s*:\s*text/html|vbscript\s*:|on\w+\s*=|\w+\s*on\w+\s*=)'

  # 常见XSS函数和对象 (包括编码变体)
  params: '(alert\s*\(|confirm\s*\(|prompt\s*\(|eval\s*\(|setTimeout\s*\(|setInterval\s*\(|Function\s*\(|document\s*\.\s*cookie|window\s*\.\s*location|document\s*\.\s*domain|document\s*\.\s*URL)'

  # DOM XSS检测
  params: '(document\.write|innerHTML\s*=|outerHTML\s*=|insertAdjacentHTML|document\.createElement)'

  # 编码绕过检测
  decoded_params: '(&#x|&#\d+|\\u|\\x|%3c|%3e|%26lt|%26gt|&#60;|&#62;).*?(script|iframe|javascript|on\w+)'

  # HTML5标签和属性
  params: '(<\s*(svg|object|embed|form|input|meta|link|base|picture|source)[^>]*>)'

  # CSS注入
  params: '(@import|expression\s*\(|javascript\s*:|binding\s*\()'

  # JSONP劫持
  params: '(callback\s*=\s*\w+jsonp|\?callback=|jsoncallback\s*=)'

severity: high
category: xss
description: |
  检测各种类型的跨站脚本攻击，包括：
  - 反射型、存储型、DOM型XSS
  - 编码绕过技术
  - HTML5新标签利用
  - CSS注入
  - JSONP劫持

  增强检测：
  - 多种编码格式识别
  - DOM XSS检测
  - 事件处理器变体
  - 属性操作检测
cwe: "CWE-79"
references:
  - "https://owasp.org/www-community/attacks/xss/"
  - "https://portswigger.net/web-security/cross-site-scripting"
  - "https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html"
attack_patterns:
  - "反射型XSS"
  - "存储型XSS"
  - "DOM型XSS"
  - "CSS注入"
  - "JSONP劫持"
response_codes: [200, 302, 404]
threat_level: "high"
impact: "可能导致会话劫持、数据窃取或恶意脚本执行"